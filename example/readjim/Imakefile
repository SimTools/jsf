#---------------------------------------------------
#
# Imakefile for readjim
# create a library, libreadjim.a
#
# (Update)
#  1-Feb-2000 A.Miyamoto  Include make JSFReadJIMCommonSize.h 
#
# $Id$
#---------------------------------------------------

#include    "config/lclib.tmpl"
#include    "conf/makejsf.tmpl"

ROOTLIBS     += -l$(EGPYTHIA) -lEG $(CERNLIBS)

LCLIBDIR      = $(LCLIBROOT)/lib

ANALLIB = $(JSFLIBS) $(EXTRALDOPT) -lJSFReadJIMBank -lJSFGUI \
	-L$(JLCSIMROOT)/lib -lct -ljlclib -lvx -lcal -lzbs -ljlcutil \
	-L$(LCLIBDIR) -lGENUTIL -lLUHADR -lTAUOLA \
        -lSIMJLC -lLTKCL -lLCFULL -lBASESV5.1 -lTBS \
        -lHELASV204 -lFORTLIB -lCOM -lCLI \
        $(EXTRALIBS)

JIMOBJ  = jlread.o \
	$(JLCSIMROOT)/util/src/getcal.o  $(JLCSIMROOT)/util/src/getcls.o \
	$(JLCSIMROOT)/util/src/getgen.o  $(JLCSIMROOT)/util/src/getmch.o \
	$(JLCSIMROOT)/util/src/gettrk.o  $(JLCSIMROOT)/util/src/getvtx.o

#-------------------------------------------------------------

CXXFLAGS     += -I$(JSFROOT)/example/guiexam1

INCPATH	      = -I./ -I$(JLCSIMROOT)/util/inc -I$(JLCSIMROOT)/include/jlc \
		-I$(JLCSIMROOT)/jimlib/inc 

SRC           = JSFReadJIMBank.$(SrcSuf) \
		JSFJIMParam.$(SrcSuf) \
		JSFJLCSIM.$(SrcSuf) JSFJIMEventDisplay.$(SrcSuf)

OBJS          = $(subst .$(SrcSuf),.$(ObjSuf),$(SRC)) \
		readjim.o $(JIMOBJ) \
		libJSFReadJIMBank.$(ObjSuf)

HDRS          = $(subst .$(SrcSuf),.h,$(SRC))

SOLIBNAME     = libJSFReadJIMBank


#if defined(AIXArchitecture)
CERNLIBS      = $(shell cernlib jetset74 packlib mathlib grafX11 )

all::  jsfrjim
AIXSOLIBS = -L$(JLCSIMROOT)/lib -lct -ljlclib -lvx -lcal -lzbs -ljlcutil \
	 -brtl -bshared -L$(JSFROOT)/lib -lJSF -lJSFLCFULL -lJSFGUI \
	$(shell root-config --glibs) \
	-L$(LCLIBROOT)/lib -lLUHADR \
	-L/cern/pro/lib -ljetset74 -lpacklib -lmathlib -lgrafX11 \
	-lX11 -lXm -lXt -lm -lodm -lC -lxlf90

jsfrjim: $(OBJS) $(JSFROOT)/src/jsfmain.o JSFReadJIMCommonSize.h
	$(CXX) $(JSFROOT)/src/jsfmain.o $(BLOCKDATA) $(OBJS) \
	$(AIXSOLIBS)  \
	-o ../../bin/jsfrjim 
#else
all::  lib jsfrjim

lib: $(OBJS)
	rm -f ../../lib/$(SOLIBNAME).$(DllSuf)
	$(LD) $(SOFLAGS) $(OBJS) -o ../../lib/$(SOLIBNAME).$(DllSuf) 

jsfrjim: $(OBJS) $(JSFROOT)/src/jsfmain.o JSFReadJIMCommonSize.h
	$(CXX) $(JSFROOT)/src/jsfmain.o $(BLOCKDATA) \
	$(LDFLAGS) -o ../../bin/jsfrjim 

#endif


clean:: 
	@rm -f $(OBJS) core *~
	@rm -f $(SOLIBNAME).*

depend:: $(SRC) $(HDRS)
	for i in $(SRC); do \
	rmkdepend -a -- $(DEPENDFILES) -- $$i; done

web: jsfrjim lib
	../../bin/jsfrjim -q -b html.C

distclean::
	@rm -f $(OBJS) core *~ *.o
	@rm -f *.bak 
	@rm -f *.root Makefile 
	@rm -f libJSFReadJIMBank*
###

$(SOLIBNAME).$(SrcSuf): $(HDRS) JSFReadJIMLinkDef.h
		@echo "Generating dictionary ..."
		rootcint -f $(SOLIBNAME).$(SrcSuf) \
	 	-c -I$(JSFROOT)/example/guiexam1 \
	 	-I$(JSFROOT)/include $(HDRS) \
		JSFReadJIMLinkDef.h


JSFReadJIMBank.cxx: JSFReadJIMCommon.h JSFReadJIMCommonSize.h

JSFReadJIMCommon.h: JSFReadJIMCommonSize.h

JSFReadJIMCommonSize.h: $(JLCSIMROOT)/include/jlc/trbuff.inc getcomsize.pl
	perl getcomsize.pl > JSFReadJIMCommonSize.h

