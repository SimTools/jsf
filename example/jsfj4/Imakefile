#
# -------------------------------------------------------------------
# This is a template of Imakefile.
# Makefile is created by
#    xmkmf -a
# To use this command, the environment variable, IMAKEINCLUDE
# must be defined as collows.
#    setenv IMAKEINCLUDE "-I$JSFROOT -I$LCLIBROOT"
#
# (Author)
#    Akiya Miyamoto  27-July-2000
#
# $Id:
#
# -------------------------------------------------------------------
#


#include "conf/makejsf.tmpl"
#include "config/lclib.tmpl"


LIBNAME = libJSFJ4

#	JSFJ4VTXHit.$(SrcSuf) JSFJ4CDCHit.$(SrcSuf) 

SRC     = JSFJ4.$(SrcSuf) \
	JSFJ4VTXHit.$(SrcSuf) \
	JSFJ4ITHit.$(SrcSuf) JSFJ4CALHit.$(SrcSuf) \
	JSFJ4PrimaryParticle.$(SrcSuf) JSFJ4PrimaryVertex.$(SrcSuf)

OBJS    = $(subst .$(SrcSuf),.$(ObjSuf),$(SRC)) \
	  $(G4OBJS) $(LIBNAME).$(ObjSuf)

G4SRC   = JSFJ4RunManager.$(SrcSuf) \
	JSFJ4PrimaryGeneratorAction.$(SrcSuf)

G4OBJS  = $(subst .$(SrcSuf),.$(ObjSuf),$(G4SRC)) \

HDRS    = $(subst .$(SrcSuf),.h,$(SRC))

.SUFFIXES: .cc
.cc.o :
	$(CXX) -c $(CPPFLAGS) $*.cc -o $*.o.

# CPPFLAGS =  -Wall -ansi -pedantic -pipe -fno-for-scope -DGNU_GCC
CPPFLAGS =  -Wall  -pipe  -DGNU_GCC $(CXXFLAGS)

JUPITERINCLUDE = -I$(JUPITERROOT)/sources/kern/include \
	-I$(JUPITERROOT)/sources/lcexp/include \
	-I$(JUPITERROOT)/sources/vtx/include \
	-I$(JUPITERROOT)/sources/it/include \
	-I$(JUPITERROOT)/sources/cdc/include \
	-I$(JUPITERROOT)/sources/cal/include \
	-I$(JUPITERROOT)/sources/ir/include \
	-I$(JUPITERROOT)/sources/bd/include \
	-I$(JUPITERROOT)/sources/sol/include

CXXFLAGS += -I./include $(JUPITERINCLUDE) \
	-I$(G4INCLUDE) \
	-DG4VIS_USE -DG4UI_USE_XM -DG4VIS_USE_OPENGLX \
	-DG4VIS_USE_OPENGLXM

#if __JSF_GNUC_VERSION__ >= 3
CXXFLAGS += -DG4USE_STD_NAMESPACE
#endif

JUPITERLIB = -L$(JUPITERROOT)/lib/$(G4SYSTEM) -lJ4bd -lJ4sol \
	-lJ4cal -lJ4cdc -lJ4ir -lJ4it -lJ4vtx -lJ4lcexp -lJ4kern

ROOTCINTOPT =
XCOMM define USE__J4CT
#undef USE__J4CT
#define USE__J4CT
#ifdef USE__J4CT
CXXFLAGS += -DUSE__J4CT
JUPITERINCLUDE += -I$(JUPITERROOT)/sources/ct/include
JUPITERLIB += -lJ4ct 
SRC  += JSFJ4CTHit.$(SrcSuf)
ROOTCINTOPT += -DUSE__J4CT
#endif

#	-lG4hadronic_man_gen 
#	-lG4hadronic_stringfrag 
#       -lG4hadronic_string_common  
#	-lG4hadronic_HE_gen 
#	-lG4hadronic_kinetic 
#	-lG4hadronic_deex 
#	-lG4hadronic_util_gen 
#	-lG4geomver 

G4LIBS := -L$(G4INSTALL)/lib/$(G4SYSTEM) \
	-L. -lG4all \
	-lGLU -lGL -lXm -lXpm -lXaw -lXmu -lXt \
	-L/usr/lib -lCLHEP

ANALLIB = -L$(LCLIBDIR) $(EXTRALDOPT) -lGENUTIL -lTAUOLA \
        -lSIMJLC -lLTKCL -lLCFULL -lTBS \
        -lHELASV204 -lFORTLIB -lCOM -lCLI \
        $(EXTRALIBS) \

ROOTLIBS     += -l$(EGPYTHIA) -lEG  $(CERNLIBS)

LDFLAGS += $(JSFLIBS) $(ANALLIB) $(JUPITERLIB) $(G4LIBS) \
	$(ROOTLIBS) $(ANALLIB) \
	-lm -ldl -l$(G77EGCS_LIBNAME)

all:: libG4all.a libJSFJ4.so 

libJSFJ4.so: $(OBJS) $(OBJG4)
	$(LD)  -shared -rdynamic  $(OBJS) $(OBJG4) $(LDFLAGS) -o libJSFJ4.so

libG4all.a: 
	./g4merge.sh

install:: libJSFJ4.so
	cp -p libJSFJ4.so ../../lib


depend:: $(SRC) $(HDR)
	for i in $(SRC); do \
	rmkdepend -a -- $(DEPENDFILES) -- $$i; done

clean::
	rm -f *~ core $(LIBNAME).*

distclean:: clean
	rm jsf.root Makefile 

$(LIBNAME).$(SrcSuf): $(HDRS) LinkDef.h
	rootcint -f $@ -c $(ROOTCINTOPT) -I$(JSFROOT)/include \
	-I$(JUPITERINCLUDE) \
	$(HDRS) LinkDef.h 
