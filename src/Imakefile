/*----------------------------------------------------------------------*/
/*  Some macros specific to jsf	building				*/
/*----------------------------------------------------------------------*/

#include    "config/lclib.tmpl"
#include    "../conf/makejsf.tmpl"

CERNLIBS      = -L$(CERN_ROOT)/lib -ljetset74 -lpacklib

ROOTLIBS     += -lEGPythia -lEG -Wl,-u,pytest_ $(CERNLIBS)

LCLIBDIR      = $(LCLIBROOT)/lib

#ifdef hitachiArchitecture
EXTRALDOPT = -Wl,-a,default 
#endif

ANALLIB = -L$(LCLIBDIR) $(EXTRALDOPT) -lGENUTIL -lLUHADR -lTAUOLA \
        -lSIMJLC -lLTKCL -lLCFULL -lBASESV5.1 -lTBS \
        -lHELASV204 -lFORTLIB -lCOM -lCLI \
        $(EXTRALIBS)

EXTRADEFINES = -I$(LCLIBROOT)/simjlc/src -I$(LCLIBROOT)/util/fortlib/src 

INC           = ../include 

/*----------------------------------------------------------------------*/
/*  Source files, headers, and objects to build				*/
/*----------------------------------------------------------------------*/

SRCJSF        = JSFSteer.$(SrcSuf) JSFModule.$(SrcSuf) \
		JSFDBS.$(SrcSuf) JSFUtil.$(SrcSuf) \
		JSFEnv.$(SrcSuf) 

SRCJSFLCFULL    = JSFBases.$(SrcSuf) \
		JSFSpringParton.$(SrcSuf) JSFSpring.$(SrcSuf) \
		JSFReadParton.$(SrcSuf) JSFMergeEvent.$(SrcSuf) \
		JSFGeneratorParticle.$(SrcSuf) JSFGenerator.$(SrcSuf) \
		JSFFULLGenerator.$(SrcSuf) JSFHadronizer.$(SrcSuf) \
		JSFLCFULL.$(SrcSuf) \
		JSFReadGenerator.$(SrcSuf) \
		DebugGenerator.$(SrcSuf) DebugWGenerator.$(SrcSuf) \
		PythiaGenerator.$(SrcSuf) 

SRCJSFQUICKSIM= JSFQuickSimParam.$(SrcSuf) JSFQuickSim.$(SrcSuf) \
		JSFLTKCLTrack.$(SrcSuf) JSFSIMDST.$(SrcSuf) \
		JSFVTXHit.$(SrcSuf) JSFCALHit.$(SrcSuf) \
		JSFHelicalTrack.$(SrcSuf) JSFCDCTrack.$(SrcSuf)

SRC = $(SRCJSF) $(SRCJSFLCFULL) $(SRCJSFQUICKSIM)


OBJJSF        = $(subst .$(SrcSuf),.$(ObjSuf),$(SRCJSF)) \
		libJSF.$(ObjSuf)

OBJJSFLCFULL  = $(subst .$(SrcSuf),.$(ObjSuf),$(SRCJSFLCFULL)) \
		readgenutil.o readparton.o \
		libJSFLCFULL.$(ObjSuf)

OBJJSFQUICKSIM= $(subst .$(SrcSuf),.$(ObjSuf),$(SRCJSFQUICKSIM)) \
		simdstutil.o \
		libJSFQuickSim.$(ObjSuf)


HDRJSF	      = $(subst .$(SrcSuf),.$(HdrSuf),$(SRCJSF)) \
		JSFBasicClasses.h \
		JSFLinkDef.h

HDRJSFLCFULL  = $(subst .$(SrcSuf),.$(HdrSuf),$(SRCJSFLCFULL)) \
		JSFLCFULLLinkDef.h

HDRJSFQUICKSIM= $(subst .$(SrcSuf),.$(HdrSuf),$(SRCJSFQUICKSIM)) \
		JSFQuickSimLinkDef.h

HDR	      = $(HDRJSF) $(HDRJSFLCFULL) $(HDRJSFQUICKSIM)

/*----------------------------------------------------------------------*/
/*  Make targets							*/
/*----------------------------------------------------------------------*/

all::  libjsf libjsflcfull libjsfquicksim jsf

libjsf:     $(OBJJSF)
		@/bin/rm -f libJSF.a
		ar -r libJSF.a $(OBJJSF)
		@cp -p libJSF.a ../lib

libjsflcfull:     $(OBJJSFLCFULL)
		@echo "Linking libJSFLCFULL.a ..."
		@/bin/rm -f libJSFLCFULL.a
		ar -r libJSFLCFULL.a $(OBJJSFLCFULL)
		@cp -p libJSFLCFULL.a ../lib

libjsfquicksim:     $(OBJJSFQUICKSIM)
		@echo "Linking libJSFQuickSim.a ..."
		@/bin/rm -f libJSFQuickSim.a
		ar -r libJSFQuickSim.a $(OBJJSFQUICKSIM)
		@cp -p libJSFQuickSim.a ../lib

jsf: $(OBJS) jsfmain.o
	$(LD) jsfmain.o $(BLOCKDATA) \
	-L../lib -lJSF -lJSFLCFULL -lJSFQuickSim $(LDFLAGS) -o jsf
	@cp -p jsf ../bin
	@rm -f jsf
	@echo jsf was installed in ../bin/jsf

clean:: 
	@rm -f $(OBJS) core *.so *~
	@rm -f libJSF.$(SrcSuf) libJSF.h
	@rm -f libJSFLCFULL.$(SrcSuf) libJSFLCFULL.h
	@rm -f libJSFQuickSim.$(SrcSuf) libJSFQuickSim.h

depend:: 
	makedepend -I$(ROOTSYS)/include -I$(JSFROOT)/include $(SRC) $(HDR)

distclean:: clean
	@rm -f $(OBJS) core *~ *.o
	@rm -f PYTHIA.SEED *.bak *.a
	@rm -f jsf *.root Makefile 

web:
	../bin/jsf -q -b html.C

libJSF.$(SrcSuf): $(HDRJSF)
		@echo "Generating dictionary ..."
		rootcint -f libJSF.$(SrcSuf) -c $(HDRJSF)
libJSFLCFULL.$(SrcSuf): $(HDRJSFLCFULL)
		@echo "Generating dictionary ..."
		rootcint -f libJSFLCFULL.$(SrcSuf) -c $(HDRJSFLCFULL)
libJSFQuickSim.$(SrcSuf): $(HDRJSFQUICKSIM)
		@echo "Generating dictionary ..."
		rootcint -f libJSFQuickSim.$(SrcSuf) -c $(HDRJSFQUICKSIM)


